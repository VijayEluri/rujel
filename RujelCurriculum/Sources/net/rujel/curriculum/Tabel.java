package net.rujel.curriculum;

import java.util.Calendar;
import java.util.GregorianCalendar;

import net.rujel.reusables.SettingsReader;

import com.webobjects.appserver.*;
import com.webobjects.foundation.*;

// Generated by the WOLips Templateengine Plug-in at May 13, 2009 2:56:05 PM
public class Tabel extends com.webobjects.appserver.WOComponent {
	public NSArray months;
	public NSDictionary currMonth;
	public Object item;
	
    public Tabel(WOContext context) {
        super(context);
        Calendar cal = Calendar.getInstance();
        cal.setTime((NSTimestamp)session().valueForKey("today"));
//        currMonth = new NSMutableDictionary(cal,"cal");
        int cmi = cal.get(Calendar.MONTH);
        NSArray monthNames = (NSArray)application().valueForKeyPath(
        		"strings.Reusables_Strings.presets.monthLong");
//        currMonth.takeValueForKey(monthNames.objectAtIndex(cmi), "name");
        cal.set(Calendar.YEAR, ((Number)session().valueForKey("eduYear")).intValue());
        cal.set(Calendar.MONTH,
        		SettingsReader.intForKeyPath("edu.newYearMonth",GregorianCalendar.JULY));
        NSDictionary[] mns = new NSDictionary[12 + 
                  ((SettingsReader.intForKeyPath("edu.newYearDay",1) > 1)?1:0)];
        for (int i = 0; i < mns.length; i++) {
        	int m = cal.get(Calendar.MONTH);
			mns[i] = new NSDictionary(new Object[] {
					new Integer(cal.get(Calendar.YEAR)), new Integer(m)
						,monthNames.objectAtIndex(m)}
			,new Object[] { "year", "month", "name" });
			if(m == cmi)
				currMonth = mns[i];
			cal.add(Calendar.MONTH, 1);
		}
        months = new NSArray(mns);
    }
    
    public String title() {
    	return (String)application().valueForKeyPath(
    			"strings.RujelCurriculum_Curriculum.Tabel.title");
    }
    
    public WOActionResults export() {
    	WOComponent exportPage = pageWithName("TabelExport");
    	exportPage.takeValueForKey(currMonth, "monthDict");
    	return exportPage;
    }
}