package net.rujel.ui;

import java.text.Format;
import java.text.ParseException;

import net.rujel.base.MyUtility;
import net.rujel.reusables.Period;

import com.webobjects.appserver.*;

// Generated by the WOLips Templateengine Plug-in at Feb 20, 2009 2:04:55 PM
public class PeriodSelector extends com.webobjects.appserver.WOComponent {
    public String begin;
    public String end;
    protected static final Format df = MyUtility.dateFormat();
	
	//public NSArray periods;
	public Period period;
    public Period perItem;
	
	public PeriodSelector(WOContext context) {
        super(context);
    }
	
	public void setFromPeriod(boolean setBegin, boolean setEnd) {
		if(period == null)
			return;
		if (setBegin)
			begin = df.format(period.begin());
		if (setEnd)
			end = df.format(period.end());
	}
	
    public void appendToResponse(WOResponse aResponse, WOContext aContext) {
    	//periods = (NSArray)session().valueForKeyPath("modules.periods");
    	Object tmp = valueForBinding("begin");
    	begin = (tmp == null)?null:df.format(tmp);
    	tmp = valueForBinding("end");
    	end = (tmp == null)?null:df.format(tmp);
    	period = (Period)valueForBinding("period");
    	if(period != null) {
    		setFromPeriod(begin == null, end == null);
    	}
    	super.appendToResponse(aResponse, aContext);
    }

    public void takeValuesFromRequest(WORequest aRequest, WOContext aContext) {
    	//periods = (NSArray)session().valueForKeyPath("modules.periods");
    	super.takeValuesFromRequest(aRequest, aContext);
    	if(hasBinding("period")) {
    		setValueForBinding(period, "period");
    	}
    	if (period != null) {
			boolean setBegin = hasBinding("begin");
			if(setBegin && begin != null && valueForBinding("begin") != null)
				setBegin = begin.equals(df.format(valueForBinding("begin")));
			boolean setEnd = hasBinding("end");
			if(setEnd && end != null && valueForBinding("end") != null)
				setEnd = end.equals(df.format(valueForBinding("end")));
			setFromPeriod(setBegin, setEnd);
		}
		if(canSetValueForBinding("begin")) {
			if(begin == null) {
				setValueForBinding(null, "begin");
			} else {
				try {
					setValueForBinding(df.parseObject(begin), "begin");
				} catch (ParseException e) {
					;
				}
			}
		}
    	if(canSetValueForBinding("end")) {
			if(end == null) {
				setValueForBinding(null, "end");
			} else {
				try {
					setValueForBinding(df.parseObject(end), "end");
				} catch (ParseException e) {
					;
				}
			}
		}
     }

    public WOActionResults submit() {
    	WOActionResults result = (WOActionResults)valueForBinding("selectAction");
    	return result;
    }
    
	public void reset() {
		begin = null;
		end = null;
		period = null;
		super.reset();
	}
	
	public boolean isStateless() {
		return true;
	}
	
	public boolean synchronizesVariablesWithBindings() {
        return false;
	}
}